# ğŸ“š HÆ¯á»šNG DáºªN PHÃ‚N QUYá»€N STAFF - QUáº¢N LÃ ÄÆ N HÃ€NG, SÃCH & BÃOÃO

## ğŸ¯ Má»¥c tiÃªu
Cáº¥p quyá»n cho nhÃ¢n viÃªn (staff) Ä‘á»ƒ:
- âœ… Quáº£n lÃ½ Ä‘Æ¡n hÃ ng (mÆ°á»£n/tráº£ sÃ¡ch)
- âœ… Quáº£n lÃ½ sÃ¡ch
- âœ… Xem bÃ¡o cÃ¡o

---

## ğŸš€ CÃCH THá»°C HIá»†N NHANH NHáº¤T

### **Windows (Cháº¡y file .bat):**
```cmd
PHÃ‚N_QUYá»€N_STAFF.bat
```

### **Linux/Mac (Cháº¡y lá»‡nh má»™t):**
```bash
php artisan db:seed --class=RolePermissionSeeder && php artisan migrate && php artisan cache:clear
```

---

## ğŸ“‹ CHI TIáº¾T Tá»ªNG BÆ¯á»šC

### **BÆ°á»›c 1: Cáº­p nháº­t Permissions vÃ  Roles**

File Ä‘Ã£ Ä‘Æ°á»£c chá»‰nh sá»­a: `database/seeders/RolePermissionSeeder.php`

Quyá»n cá»§a STAFF Ä‘Æ°á»£c thÃªm vÃ o bao gá»“m:
```
âœ“ view-dashboard        - Xem dashboard
âœ“ view-books           - Xem sÃ¡ch
âœ“ create-books         - ThÃªm sÃ¡ch má»›i
âœ“ edit-books           - Chá»‰nh sá»­a sÃ¡ch
âœ“ view-categories      - Xem danh má»¥c
âœ“ view-borrows         - Xem Ä‘Æ¡n hÃ ng
âœ“ create-borrows       - Táº¡o Ä‘Æ¡n hÃ ng
âœ“ edit-borrows         - Chá»‰nh sá»­a Ä‘Æ¡n hÃ ng
âœ“ return-books         - Xá»­ lÃ½ tráº£ sÃ¡ch
âœ“ view-reservations    - Xem Ä‘áº·t chá»—
âœ“ confirm-reservations - XÃ¡c nháº­n Ä‘áº·t chá»—
âœ“ view-readers         - Xem Ä‘á»™c giáº£
âœ“ view-reports         - Xem bÃ¡o cÃ¡o
âœ“ export-reports       - Xuáº¥t bÃ¡o cÃ¡o
âœ“ view-notifications   - Xem thÃ´ng bÃ¡o
âœ“ view-reviews         - Xem Ä‘Ã¡nh giÃ¡
âœ“ approve-reviews      - PhÃª duyá»‡t Ä‘Ã¡nh giÃ¡
```

Cháº¡y:
```bash
php artisan db:seed --class=RolePermissionSeeder
```

### **BÆ°á»›c 2: Táº¡o Staff User vÃ  GÃ¡n Role**

File migration Ä‘Ã£ Ä‘Æ°á»£c táº¡o: `database/migrations/2026_01_26_000000_create_staff_user_and_assign_role.php`

TÃ i khoáº£n staff máº«u Ä‘Æ°á»£c táº¡o:
- **Email**: staff@library.com
- **Password**: 123456

Cháº¡y:
```bash
php artisan migrate
```

### **BÆ°á»›c 3: XÃ³a Cache**
```bash
php artisan cache:clear
php artisan config:clear
```

---

## ğŸ”§ GÃN STAFF ROLE CHO USER CÃ“ Sáº´N

### **CÃ¡ch 1: DÃ¹ng Tinker (Nhanh nháº¥t)**

```bash
php artisan tinker
```

Rá»“i gÃµ:
```php
$user = App\Models\User::find(2);  // Thay 2 báº±ng ID thá»±c
$user->assignRole('staff');
$user->update(['role' => 'staff']);
dd('Done');
exit
```

### **CÃ¡ch 2: DÃ¹ng PHP Script**

```bash
php assign_staff_role.php 2
```

(Thay 2 báº±ng ID user cáº§n gÃ¡n)

### **CÃ¡ch 3: DÃ¹ng SQL trá»±c tiáº¿p**

Má»Ÿ file `PHÃ‚N_QUYá»€N_STAFF.sql` vÃ  cháº¡y cÃ¡c query tÆ°Æ¡ng á»©ng.

VÃ­ dá»¥ gÃ¡n cho user ID = 2:
```sql
SET @staff_role_id = (SELECT id FROM roles WHERE name = 'staff' LIMIT 1);
INSERT INTO model_has_roles (role_id, model_type, model_id)
VALUES (@staff_role_id, 'App\\Models\\User', 2);
UPDATE users SET role = 'staff' WHERE id = 2;
```

---

## âœ… KIá»‚M TRA Káº¾T QUáº¢

### Kiá»ƒm tra xem staff Ä‘Ã£ cÃ³ quyá»n chÆ°a:

```bash
php artisan tinker
```

```php
$staff = App\Models\User::find(2);  // Thay 2 báº±ng ID staff
$staff->role;                       // Xem role attribute
$staff->getRoleNames();             // Xem táº¥t cáº£ role
$staff->getPermissionNames();       // Xem táº¥t cáº£ quyá»n
$staff->can('view-borrows');        // Kiá»ƒm tra permission cá»¥ thá»ƒ (return true/false)
```

---

## ğŸ® KIá»‚M THá»¬ÄÄ‚NG NHáº¬P

1. ÄÄƒng nháº­p vá»›i tÃ i khoáº£n staff:
   - Email: `staff@library.com`
   - Password: `123456`

2. Báº¡n sáº½ cÃ³ thá»ƒ truy cáº­p:
   - âœ… Quáº£n lÃ½ Ä‘Æ¡n hÃ ng
   - âœ… Quáº£n lÃ½ sÃ¡ch
   - âœ… Xem bÃ¡o cÃ¡o
   - âŒ Quáº£n lÃ½ ngÆ°á»i dÃ¹ng (chá»‰ admin)
   - âŒ CÃ i Ä‘áº·t (chá»‰ admin)

---

## ğŸ“ HÆ¯á»šNG DáºªN CHI TIáº¾T

Xem file `PHÃ‚N_QUYá»€N_STAFF.md` Ä‘á»ƒ cÃ³ hÆ°á»›ng dáº«n chi tiáº¿t hÆ¡n bao gá»“m:
- CÃ¡ch báº£o vá»‡ routes
- CÃ¡ch kiá»ƒm tra quyá»n trong Blade template
- CÃ¡ch kiá»ƒm tra quyá»n trong Controller
- CÃ¡ch thÃªm quyá»n má»›i
- CÃ¢u há»i thÆ°á»ng gáº·p
- VÃ  nhiá»u ná»™i dung khÃ¡c

---

## ğŸ”„ Cáº¬P NHáº¬T QUYá»€N (Náº¿u cáº§n thay Ä‘á»•i sau)

### ThÃªm quyá»n má»›i cho staff:

```bash
php artisan tinker
```

```php
$staffRole = Spatie\Permission\Models\Role::findByName('staff');
$staffRole->givePermissionTo('delete-books');  // ThÃªm quyá»n xÃ³a sÃ¡ch
exit
```

### Loáº¡i bá» quyá»n tá»« staff:

```php
$staffRole = Spatie\Permission\Models\Role::findByName('staff');
$staffRole->revokePermissionTo('delete-books');  // Loáº¡i bá» quyá»n xÃ³a sÃ¡ch
exit
```

---

## âš ï¸ LÆ¯U Ã QUAN TRá»ŒNG

1. **XÃ³a Cache**: Náº¿u thay Ä‘á»•i quyá»n mÃ  khÃ´ng tháº¥y hiá»‡u quáº£, cháº¡y:
   ```bash
   php artisan cache:clear
   ```

2. **Kiá»ƒm tra Middleware**: Äáº£m báº£o routes Ä‘Æ°á»£c báº£o vá»‡ báº±ng:
   - `middleware('permission:view-borrows')`
   - `middleware('staff')`

3. **Kiá»ƒm tra Blade Template**: Sá»­ dá»¥ng `@can` directive Ä‘á»ƒ kiá»ƒm soÃ¡t hiá»ƒn thá»‹ UI

4. **Database Backup**: NÃªn backup database trÆ°á»›c khi thay Ä‘á»•i quyá»n

---

## ğŸ“ Cáº¦N GIÃšP?

CÃ¡c file tham kháº£o:
- `PHÃ‚N_QUYá»€N_STAFF.md` - HÆ°á»›ng dáº«n chi tiáº¿t
- `PHÃ‚N_QUYá»€N_STAFF.sql` - Script SQL
- `assign_staff_role.php` - Script PHP
- `database/seeders/RolePermissionSeeder.php` - Cáº¥u hÃ¬nh roles/permissions

---

**Táº¡o ngÃ y**: 26/01/2026  
**PhiÃªn báº£n**: 1.0  
**Há»‡ thá»‘ng**: Laravel vá»›i Spatie Permission
